---
title: "Introdução ao *tidyverse* <br><br>"
subtitle: "<br> 3 *tidyverse* <br>"
author: "Maurício Vancine"
date: "25/04/2019"
output:
  xaringan::moon_reader:
    css: [metropolis]
    lib_dir: libs
    nature:
      highlightStyle: rainbow
      highlightLines: true
      countIncrementalSlides: false
    includes:
      in_header: header.html
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
if(!require(countdown)) devtools::install_github("gadenbuie/countdown")
```

class: clear, center, middle
background-image: url(img/package_tidyverse.png)
background-size: 400px
background-position: 50% 50%

---

background-image: url(img/package_tidyverse.png)
background-size: 350px
background-position: 85% 75%

# 3 tidyverse

## Conteúdo

3.1 Pacote tidyverse
<br>
3.2 Pacote readr
<br>
3.3 Pacotes readxl e writexl
<br>
3.4 Pacote tibble
<br>
3.5 Pacote magrittr (*pipe - %>%*)
<br>
3.6 Pacote tidyr
<br>
3.7 Pacote dplyr
<br>
3.8 Pacote forcats
<br>
3.9 Pacote lubridate
<br>
3.10 Pacote stringr
<br>
3.11 Pacote purrr

---

# 3 tidyverse
## Script

<br><br><br><br><br><br>

## .center[`script_aula_03.R`]


---

class: clear, center, middle
background-image: url(img/package_tidyverse.png)
background-size: 400px
background-position: 50% 50%

---

# 3.1 Pacote tidyverse

### O tidyverse é um **pacote** com a função de **instalar** e **carregar** outros pacotes

--

### O **conjunto** desses pacotes forma o **tidyverse**

--

### É considerado um “universo” à parte do R, pois todas as suas **ferramentas** possuem formas de uso consistentes e **funcionam** muito bem em conjunto

--

### Seu uso é mais voltado para a **Ciência de Dados**

--

### E depois que vocês **aprenderem**, nunca mais usaram o R de outra forma...

---

class: inverse, center
background-image: url(img/gig_avenger_reference.gif)
background-size: 800px

# Iniciativa Vingadores do R

---

background-image: url(img/tidyverse_flowchart.png)
background-size: 800px
background-position: 50% 60%

# 3.1 Pacote tidyverse

---

background-image: url(img/general_data_science_r4ds.png)
background-size: 800px
background-position: 50% 50%

# 3.1 Pacote tidyverse

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/general_messy_data.png)
background-size: 800px
background-position: 50% 50%

# 3.1 Pacote tidyverse

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@ViviFabrien](https://twitter.com/ViviFabrien)

---

background-image: url(img/person_hadley_wickham.jpg)
background-size: 550px
background-position: 50% 60%

# 3.1 Pacote tidyverse

### O idealizador foi o **Hadley Wickham** e atualmente **muitas pessoas** têm contribuído para sua expansão

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://hadley.nz/

---

background-image: url(img/article_tidy.png)
background-size: 400px
background-position: 50% 60%

# 3.1 Pacote tidyverse

### Tidy Data (2014) - *Journal of Statistics Software*

#### Hadley Wickham

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://vita.had.co.nz/papers/tidy-data.pdf

---

background-image: url(img/cover_data_science_r.png)
background-size: 300px
background-position: 50% 55%

# 3.1 Pacote tidyverse

## R for Data Science (2017)

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://r4ds.had.co.nz/

---

background-image: url(img/tidyverse_site1.png)
background-size: 800px
background-position: 50% 50%

# 3.1 Pacote tidyverse

## Sites

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.tidyverse.org/

---

background-image: url(img/tidyverse_site2.png)
background-size: 800px
background-position: 50% 50%

# 3.1 Pacote tidyverse

## Sites

<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://rpubs.com/modelthinkingbr/dados

---

# 3.1 Pacote tidyverse

### Para utilizar os pacotes do **tidyverse** é preciso instalar e carregar o pacote `tidyverse`

```{r,eval=FALSE}
# instalar o pacote
install.packages("tidyverse")
```

--

```{r,message=TRUE}
# carregar o pacote
library(tidyverse)
```

---

background-image: url(img/code_snake_case.png)
background-size: 500px
background-position: 80% 80%

# 3.1 Pacote tidyverse

## IMPORTANTE!

### Todas as funções dos pacotes atrelados ao **tidyverse** usam `_` para separar os nomes internos das funções (snake_code)

<br><br>

`read_csv()`

`read_xlsx()`

`as_tibble()`

`left_join()`

`group_by()`

---

class: clear, center, middle
background-image: url(img/package_magrittr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.2 magrittr (pipe - %>%)

### O operador pipe (*%>%*) permite o “encadeamento” de várias funções e **não é preciso de objetos** para armazenar resultados intermediários

--

### Essa função torna os códigos em R **mais simples**, pois realizamos **múltiplas operações** em uma **única linha**

--

### Ele captura o **resultado de uma declaração** e o **torna a entrada da próxima declaração**. Podemos pensar como *“EM SEGUIDA FAÇA”*

--

### O operador pipe é o **%>%**: (atalho: `crtl + shift + M`)

---

# 3.2 magrittr (pipe - %>%)

### Atalho: `crtl + shift + M`
```{r}
# sem pipe
sqrt(sum(1:100))
```

--

background-image: url(img/general_fog.jpg)
background-size: 500px
background-position: 50% 80%

---

# 3.2 magrittr (pipe - %>%)

### Atalho: `crtl + shift + M`
```{r}
# sem pipe
sqrt(sum(1:100))
```

```{r}
# com pipe
1:100 %>% 
  sum() %>% 
  sqrt()
```

---

class: clear, inverse, center, middle
background-image: url(img/gif_uou.webp)
background-size: 800px
background-position: 50% 50%

---

# 3.2 magrittr (pipe - %>%)

### Atalho: `crtl + shift + M`
```{r}
# fixar amostragem
set.seed(42)

# sem pipe
ve <- sum(sqrt(sort(log10(rpois(100, 10)))))
ve
```
--
```{r}
# fixar amostragem
set.seed(42)

# com pipe
ve <- rpois(100, 10) %>% 
  log10() %>%
  sort() %>% 
  sqrt() %>% 
  sum()
ve  
```

---

class: clear, inverse, center, middle
background-image: url(img/gif_mario.gif)
background-size: 700px
background-position: 50% 50%

---

class: clear, inverse, center, middle

# Exercícios

---

# Exercício 09

## Reescreva as operações utilizando pipes `%>%`:
`log10(cumsum(1:100))`

`sum(sqrt(rnorm(100)))`

`prod(sort(sample(1:10, 10000, rep = TRUE)))`

```{r echo = FALSE}
countdown(minutes = 2, seconds = 00, color_background = "gray30")
```

---

# Exercício 09
## Solução
```{r,eval=FALSE}
# solucao
# 1.
log10(cumsum(1:100))

1:100 %>%
  cumsum %>% 
  log10
```
---

# Exercício 09
## Solução
  
```{r,eval=FALSE}
# 2.
sum(sort(rnorm(100)))

100 %>% 
  rnorm %>% 
  sort %>% 
  sum
```
---

# Exercício 09
## Solução

```{r,eval=FALSE}
# 3.
scale(sample(1:10, 10000, rep = TRUE))

1:10 %>% 
  sample(10000, rep = TRUE) %>% 
  scale
```

---

class: clear, inverse, center, middle

# Dúvidas?

---

class: clear, center, middle
background-image: url(img/package_readr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.3 readr

### **Carrega e salva** grandes arquivos de forma **mais rápida**

--

### As funções **read.csv()** e **read.csv2()** são substituídas pelas funções **read_csv()** e **read_csv2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .csv: **write_csv()** e **write_csv2()**

---

background-image: url(img/general_data_eu_mesmo.png)
background-size: 600px
background-position: 50% 90%

# 3.3 readr

## ATLANTIC AMPHIBIANS: a dataset of amphibian communities from the Atlantic Forests of South America

### Eu mesmo et al. (2018)

---

# 3.3 readr

## **Formato .csv**
```{r,eval=FALSE}
# diretorio
setwd("/home/mude/data/github/minicurso-tidyverse/03_dados")
```
--
```{r,eval=FALSE}
# import sites
si <- readr::read_csv("ATLANTIC_AMPHIBIANS_sites.csv")
si
```

```{r,echo=FALSE}
si <- readr::read_csv("/home/mude/data/github/minicurso-r-sebio-2019/03_dados/ATLANTIC_AMPHIBIANS_sites.csv")
si
```


---

# 3.3 readr

## **Formato .txt**

```{r,eval=FALSE}
# diretorio
setwd("/home/mude/data/github/minicurso-tidyverse/03_dados")
```
--
```{r,eval=FALSE}
# import sites
si <- readr::read_tsv("ATLANTIC_AMPHIBIANS_sites.txt")
si
```

```{r,echo=FALSE}
si <- readr::read_csv("/home/mude/data/github/minicurso-r-sebio-2019/03_dados/ATLANTIC_AMPHIBIANS_sites.csv")
si
```

---

class: clear, center, middle
background-image: url(img/package_readxl.png)
background-size: 400px
background-position: 50% 50%

---

# 3.4 readxl e writexl

## São pacotes à parte do **tidyverse**

<br><br><br>

```{r,eval=FALSE}
install.packages("readxl")
library("readxl")
```

<br>
--


```{r,eval=FALSE}
install.packages("writexl")
library("writexl")
```

---

# 3.4 readxl e writexl

### **Carrega e salva** grandes arquivos de forma **mais rápida** no formato **.xlsx**

--

### Funções **read_xlsx()** e **read_xlsx2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .xlsx: **write_xlsx()** e **write_xlsx2()**

---

# 3.4 readxl e writexl

## **Formato .xlsx**

```{r,eval=FALSE}
# diretorio
setwd("/home/mude/data/github/minicurso-tidyverse/03_dados")
```
--
```{r,eval=FALSE}
# import sites
si <- readxl::read_xlsx("ATLANTIC_AMPHIBIANS_sites.xlsx")
si
```

```{r,echo=FALSE}
si <- readr::read_csv("/home/mude/data/github/minicurso-r-sebio-2019/03_dados/ATLANTIC_AMPHIBIANS_sites.csv")
si
```

---

class: clear, inverse, center, middle

# Dúvidas?

---
class: clear, center, middle
background-image: url(img/package_tibble.png)
background-size: 400px
background-position: 50% 50%

---

# 3.5 tibble

### O tibble (classe *tbl_df*) é um **tipo especial de data frame**

--

### É o **formato** aconselhado para que as funções do tidyverse **funcionem**

--

### Converter **data frame** em **tibble** usa-se a função `as_tibble()`

--

### Converter **tibble** em **data frame** usa-se a função `as_data_frame()`

--

### Cada variável pode ser do tipo *numbers(int, dbl)*, *character(chr)*, *logical(lgl)* ou *factor(fctr)*

---

# 3.5 tibble

## Descrição dos modos das colunas através da função `glimpse()`

```{r, include = FALSE}
si <- readr::read_csv("/home/mude/data/github/minicurso-r-sebio-2019/03_dados/ATLANTIC_AMPHIBIANS_sites.csv")
```
--
```{r}
tibble::glimpse(si)
```

---

# 3.5 tibble

## tibble vs data.frame

### 1. Nunca converte um tipo **character como factor**
```{r}
df <- data.frame(ch = c("a", "b"), nu = 1:2)
str(df)
```
--
```{r, message = FALSE}
tb <- tibble(ch = c("a", "b"), nu = 1:2)
glimpse(tb)
```

---

# 3.5 tibble

## tibble vs data.frame

### 2. A indexação com colchetes sempre retorna um **tibble**
```{r}
df_ch <- df[, 1]
class(df_ch)
```
--
```{r}
tb_ch <- tb[, 1]
class(tb_ch)
```
--
```{r}
# indexacao pelo nome devolve um vetor
tb_ch <- tb$ch
class(tb_ch)
```

---

# 3.5 tibble

## tibble vs data.frame

### 3. Não faz correspondência parcial, retorna **NULL** se a coluna não existe com o nome especificado
```{r}
df$c 
```
--
```{r, error = TRUE}
tb$c
```

---

class: clear, inverse, center, middle

# Dúvidas?

---

class: clear, center, middle
background-image: url(img/package_tidyr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.6 tidyr

### Os conjuntos de dados **tidy** (organizados) são fáceis de manipular, modelar e visualizar

--

### Um conjunto de dados está **arrumado ou não**, dependendo de como linhas, colunas e células são combinadas com observações, variáveis e valores

--

## Nos dados tidy:
### 1 Cada variável em uma coluna
### 2 Cada observação em uma linha
### 3 Cada valor como uma célula

---

background-image: url(img/tidyr_data.png)
background-size: 800px
background-position: 50% 50%

# 3.6 tidyr

---

# 3.6 tidyr

## Funções

#### **1 unite()**: junta dados de múltiplas colunas em uma

#### **2 separate()**: separa caracteres em múlplica colunas

#### **3 separate_rows()**: separa caracteres em múlplica colunas e linhas

#### **4 drop_na()**: retira linhas com NA

#### **5 replace_na()**: substitui NA

#### **6 spread() | pivot_wider()**: long para wide

#### **7 gather() | pivot_longer()**: wide para long

---

background-image: url(img/tidyr_unite.png)
background-size: 800px
background-position: 50% 50%

# 3.6 tidyr

---

# 3.6 tidyr

## **1 unite**

### unir as colunas latirude e longitude separadas por uma vírgula
```{r,eval=FALSE}
si_unite <- tidyr::unite(si, "lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

```{r,echo=FALSE}
si_unite <- tidyr::unite(si, "lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```


---

# 3.6 tidyr

## **1 unite**

### unir as colunas latirude e longitude separadas por uma vírgula
```{r,eval=FALSE}
si_unite <- si %>% 
  tidyr::unite("lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

```{r,echo=FALSE}
si_unite <- si %>% 
  tidyr::unite("lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

---

background-image: url(img/tidyr_separate.png)
background-size: 800px
background-position: 50% 50%

# 3.6 tidyr

---

# 3.6 tidyr

## **2 separate**

### separar os dados de "period" em quatro colunas dos seus valores
```{r,eval=FALSE}
si_separate <- si %>% 
  tidyr::separate("period", c("mo", "da", "tw", "ni"), remove = FALSE)
si_separate[, c(1, 9:13)]
```

```{r,echo=FALSE}
si_separate <- si %>% 
  tidyr::separate("period", c("mo", "da", "tw", "ni"), remove = FALSE)
si_separate[, c(1, 9:13)]
```

---

# 3.6 tidyr

## **3 separate_rows()**

### separar os dados de "period" em quatro colunas dos seus valores
```{r,eval=FALSE}
si_separate_row <- si %>% 
  tidyr::separate_rows("period")
si_separate_row[, c(1, 9:13)]
```

```{r,echo=FALSE}
si_separate_row <- si %>% 
  tidyr::separate_rows("period")
si_separate_row[, c(1, 9:13)]
```


---

# 3.6 tidyr

## **4 drop_na()**

### remove as linhas com NA de todas as colunas
```{r,eval=FALSE}
si_drop_na <- si %>% 
  tidyr::drop_na()
si_drop_na
```

```{r,echo=FALSE}
si_drop_na <- si %>% 
  tidyr::drop_na()
si_drop_na
```

---

# 3.6 tidyr

## **4 drop_na()**
### remove as linhas com NA da coluna "year_start"
```{r,eval=FALSE}
si_drop_na <- si %>% 
  tidyr::drop_na(year_start)
si_drop_na
```

```{r,echo=FALSE}
si_drop_na <- si %>% 
  tidyr::drop_na(year_start)
si_drop_na
```

---

# 3.6 tidyr

## **5 replace_na()**

### substituir os NAs da coluna "year_start" por 0 
```{r,eval=FALSE}
si_replace_na <- si %>% 
  tidyr::replace_na(list(year_start = 0))
si_replace_na
```

```{r,echo=FALSE}
si_replace_na <- si %>% 
  tidyr::replace_na(list(year_start = 0))
si_replace_na
```

---

background-image: url(img/tidyr_spread_pivot_wider.png)
background-size: 800px
background-position: 50% 50%

# 3.6 tidyr

---

# 3.6 tidyr

## **5 spread()** 

Long para wide

1. **key**: variável categórica que irá definir os nomes das colunas

2. **value**: variável numérica que irá preencher os dados

```{r}
si_spread <- si[, c("id", "record", "species_number")] %>% 
  spread(key = record, value = species_number, fill = 0)
si_spread
```

---

# 3.6 tidyr

## **5 spread()** 

Long para wide

1. **key**: variável categórica que irá definir os nomes das colunas

2. **value**: variável numérica que irá preencher os dados

```{r, eval = FALSE}
si_spread <- si[, c("id", "record", "species_number")] %>% 
  spread(key = state_abbreviation, value = species_number, fill = 0)
si_spread
```

---

# 3.6 tidyr

## **5 spread()** 

Long para wide

1. **key**: variável categórica que irá definir os nomes das colunas

2. **value**: variável numérica que irá preencher os dados

```{r, eval = FALSE}
sp_spread <- sp[1:1000, c("id", "species", "individuals")] %>% 
  spread(key = species, value = individuals, fill = 0)
sp_spread
```

---

background-image: url(img/tidyr_gather_pivot_longer.png)
background-size: 800px
background-position: 50% 50%

# 3.6 tidyr

---

# 3.6 tidyr

## **6 gather()**

wide para long

1. **key**: variável categórica que irá definir os nomes das colunas

2. **value**: variável numérica que irá preencher os dados

```{r}
si_gather <- si_spread %>% 
  gather(key = record, value = species_number, -id)
si_gather
```

---

class: clear, inverse, center, middle

# Exercícios

---

# Exercício 10
### Combine as colunas `country`, `state`, `state_abbreviation`, `municipality`, `site`, em uma coluna chamada `local_total` separadas por `, (vírgula + espaço)`, atribuindo o resultado a um novo objeto, utilizando o formato tidyverse

```{r echo = FALSE}
countdown(minutes = 1, seconds = 00, color_background = "gray30")
```

---

# Exercício 10
## Solução
```{r}
si_local <- si %>% 
  tidyr::unite("local_total", c(country, state, state_abbreviation, 
                         municipality, site), sep = ", ")
si_local$local_total
```

---

class: clear, inverse, center, middle

# Dúvidas?

---

class: clear, center, middle
background-image: url(img/package_dplyr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.7 dplyr

background-image: url(img/dplyr_wrangling.png)
background-size: 400px
background-position: 50% 50%

---

# 3.7 dplyr

### O **dplyr** é um pacote que **facilita** o trabalho com dados, com uma **gramática de manipulação** de dados **simples e flexível** (filtragem, reordenamento, seleção, entre outras)

--

### Ele foi construído com o intuito de obter uma forma **mais rápida** e **expressiva** de tratar os dados 

--

### O **tibble** é a **versão de data frame** mais **conveniente** para **se usar** com dplyr

---

# 3.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

--

## Funções

**Verbos**: mutate(), select(), filter(), arrange(), summarise(), slice(), rename(), etc
**Sufixos**: _at(), _if(), _all(), etc
**Agrupamento**: group_by() e ungroup()
**Junções**: inner_join(), full_join(), left_join() e right_join()
**Funções resumo**: n(), n_distinct(), first(), last(), nth(), etc.

---

# 3.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

**1 select()**: seleciona colunas pelo nome gerando um tibble<br>
**2 pull()**: seleciona uma coluna como vetor<br>
**3 rename()**: muda o nome das colunas<br>
**4 mutate()**: adiciona novas colunas ou adiciona resultados em colunas existentes<br>
**5 arrange()**: reordenar as linhas com base nos valores de colunas<br>
**6 filter()**: seleciona linhas com base em valores<br>
**7 distinc()**: remove linhas com valores repetidos com base nos valores de colunas<br>
**8 slice()**: seleciona linhas pelos números<br>
**9 sample_n()**: amostragem aleatória de linhas<br>
**10 summarise()**: agrega ou resume os dados através de funções, podendo considerar valores das colunas<br>
**11 join()**: junta dados de duas tabelas através de uma coluna chave

---

# 3.7 dplyr

### O **tibble** é sempre o **primeiro argumento** das funções verbais

--

### Todas seguem a mesma sintaxe: 

### 1. tibble

### 2. operador pipe 

### 3. nome da função verbal com os argumentos entre parênteses 

--

<br> 

### As funções verbais **não modificam** o tibble original

--

```{r,eval=FALSE}
sp_dplyr <- sp %>% 
  funcao_verbal(argumento1, argumento2)
```

---

background-image: url(img/dplyr_select.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **1 select**

---

# 3.7 dplyr

## **1 select**

### Seleciona colunas pelo nome

```{r}
si_select <- si %>% 
  dplyr::select(id, longitude, latitude)
si_select
```

---

# 3.7 dplyr

## **1 select**

### Remove as colunas pelo nome

```{r}
si_select <- si %>% 
  dplyr::select(-c(id, longitude, latitude))
si_select
```
---

# 3.7 dplyr

## **1 select**

### Seleciona colunas por um padrão

```{r}
#  starts_with(), ends_with() e contains()
si_select <- si %>% 
  dplyr::select(contains("sp"))
si_select
```

---

background-image: url(img/dplyr_pull.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **2 pull**

---

# 3.7 dplyr

## **2 pull**

```{r}
# coluna para vetor
si_pull <- si %>% 
  dplyr::pull(id)
si_pull
```

---

# 3.7 dplyr

## **2 pull**

```{r}
# coluna para vetor
si_pull <- si %>% 
  dplyr::pull(species_number)
si_pull
```

---

# 3.7 dplyr

## **3 rename**

### Renomeia colunas
```{r}
# rename sp colum
si_rename <- si %>%
  dplyr::rename(sp = species_number)
si_rename
```

---

background-image: url(img/dplyr_mutate.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **4 mutate**

---

# 3.7 dplyr

## **4 mutate**

### Adiciona colunas novas ou vindas de operações
```{r}
# add colum record as factor
si_mutate <- si %>% 
  dplyr::mutate(record_factor = as.factor(record))
si_mutate
```

---

background-image: url(img/dplyr_arrange.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **5 arrange**

---

# 3.7 dplyr

## **5 arrange**

### Ordenar de forma crescente pela coluna **species_number**
```{r,eval=FALSE}
si_arrange <- si %>% 
  dplyr::arrange(species_number)
si_arrange
```

--

### Ordenar de forma decrescente pela coluna **species_number**
```{r,eval=FALSE}
si_arrange <- si %>% 
  dplyr::arrange(desc(species_number))
si_arrange
```
--
```{r,eval=FALSE}
si_arrange <- si %>% 
  dplyr::arrange(-species_number)
si_arrange
```

---

background-image: url(img/dplyr_filter.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **6 filter**

---

# 3.7 dplyr

## **6 filter** 

### operadores: >, >=, <, <=, ==, !=, is.na, !is.na, %in%
### Filtrar para locais com mais de 5 espécies
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5)
si_filter
```
--
### Filtrar para locais centre 1 e 5 espécies
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(between(species_number, 1, 5))
si_filter
```

---

# 3.7 dplyr

## **6 filter** 
### Filtrar para locais sem NA no métodos passivos
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(is.na(passive_methods))
si_filter
```
--
### Filtrar para locais sem NA no métodos ativos **E** passivos
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(is.na(active_methods) & is.na(passive_methods))
si_filter
```

---

# 3.7 dplyr

## **6 filter** 
### Filtrar para locais amostrados com mais de 5 espécies **E** em Pernambuco
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5 & state_abbreviation == "BR-PE") 
si_filter
```
--
### Filtrar para locais amostrados com mais de 5 espécies **OU** em Pernambuco
```{r,eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5 | state_abbreviation == "BR-PE")
si_filter
```

---

# 3.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies
```{r}
si_distinct <- si %>% 
  dplyr::distinct(species_number)
si_distinct
```

---

# 3.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies e mantém as demais
```{r}
si_distinct <- si %>% 
  dplyr::distinct(species_number, .keep_all = TRUE)
si_distinct
```

---

# 3.7 dplyr

## **8 slice** 
### Selecionar linhas 1 a 10
```{r}
si_slice <- si %>% 
  dplyr::slice(1:10)
si_slice
```

---

# 3.7 dplyr

## **9 n_sample** 

### Amostrar 100 linhas aleatoriamente
```{r}
si_sample_n <- si %>% 
  dplyr::sample_n(100)
si_sample_n
```


---

background-image: url(img/dplyr_summarize.png)
background-size: 800px
background-position: 50% 50%

# 3.7 dplyr

## **10 summarise**

---

# 3.7 dplyr

## **10 summarise**

### Média e desvio padrão do número de espécies total

```{r}
si_summarise <- si %>% 
  dplyr::summarise(mean_sp = mean(species_number), sd_sp = sd(species_number))
si_summarise
```

---

# 3.7 dplyr

## **10 summarise**
### Média e desvio padrão do número de espécies por país
```{r}
si_summarise_group <- si %>% 
  dplyr::group_by(country) %>% 
  dplyr::summarise(mean_sp = mean(species_number), sd_sp = sd(species_number))
si_summarise_group
```

---

# 3.7 dplyr
## Permite manipular os dados de forma mais simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number)
da
```

---

# 3.7 dplyr
## Permite manipular os dados de forma mais simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5)
da
```

---

# 3.7 dplyr
## Permite manipular os dados de forma mais simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5) %>% 
  dplyr::group_by(state_abbreviation) %>% 
  dplyr::summarise(nsp_state_abb = n())
da
```

---

# 3.7 dplyr
## Permite manipular os dados de forma mais simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5) %>% 
  dplyr::group_by(state_abbreviation) %>% 
  dplyr::summarise(nsp_state_abb = n()) %>% 
  dplyr::arrange(nsp_state_abb)
da
```

---

class: clear, inverse, center, middle

# Exercícios

---

# Exercício 11

### Adicione essas novas colunas `alt_log, tem_log e pre_log`, que são a operação `log10` das colunas `altitude,	temperature e	precipitation` e atribua ao mesmo objeto `si` utilizando o formato tidyverse

```{r echo = FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 11
## Solução
```{r}
# solucao
si <- si %>% 
  dplyr::mutate(alt_log = log10(altitude),
                tem_log = log10(temperature),
                pre_log = log10(precipitation))
si[, 25:28]
```

---

# Exercício 12

### Ordene os dados em forma decrescente pela coluna `altitude`, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo = FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 12
## Solução
```{r}
# solucao
si_ar <- si %>% 
  dplyr::arrange(-altitude)
si_ar
```

---

# Exercício 13

###  Filtre as linhas com `altitude` maior que 1000 mm, `temperature` menor que 15 ºC e `precipitation` maior que 1000 mm, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo = FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 13
## Solução
```{r}
# solucao
si_fi <- si %>% 
  dplyr::filter(altitude > 1000,
                temperature < 15,
                precipitation > 1000)
si_fi
```

---

# Exercício 14

### Amostre 200 linhas aleatoriamente com número de espécies maior que 15 espécies, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo = FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 14
## Solução
```{r}
# solucao
si_sa <- si %>% 
  dplyr::filter(species_number > 15) %>% 
  dplyr::sample_n(200)
si_sa
```

---

class: clear, inverse, center, middle

# Dúvidas?

---

class: inverse, center, middle

# Dúvidas?

---
class: clear, center, middle
background-image: url(https://www.rstudio.com/wp-content/uploads/2014/04/stringr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.8 stringr

## Pacote para a manipulação de characters ou strings

### Comprimento
```{r}
str_length("abc")
```

--

### Substituição
```{r}
str_sub("abc", 3)
```

---

# 3.8 stringr

### Inserir espaço em branco
```{r}
str_pad("abc", width = 4, side = "left")
```

--

### Inserir espaço em branco
```{r}
str_pad("abc", width = 4, side = "right")
```

--

### Remover espaço em branco do começo, final ou ambos
```{r}
str_trim(" abc ")
```

---

# 3.8 stringr

### Minúsculas e maiúsculas
```{r}
str_to_upper("abc")
```
--
```{r}
str_to_title("abc")
```
--
```{r}
str_to_title("aBc")
```

---

# 3.8 stringr

### Ordenarção
```{r}
le <- sample(letters, 26, rep = TRUE)
le
```
--
```{r}
str_sort(le)
```
--
```{r}
str_sort(le, dec = TRUE)
```

---

# 3.8 stringr

### Extrair
```{r}
str_extract("abc", "b")
```

### Substituir
```{r}
str_replace("abc", "a", "y")
```

### Separação
```{r}
str_split("a-b-c", "-")
```

---

class: inverse, center, middle

# Dúvidas?

---

class: clear, center, middle
background-image: url(https://www.rstudio.com/wp-content/uploads/2014/04/forcats.png)
background-size: 400px
background-position: 50% 50%

---

# 3.9 forcats

## Pacote para manejar os **levels** dos fatores

### **fct_relevel**: reordena os levels de forma simples
```{r}
# fixar amostragem
set.seed(1)

# criar um fator
fa <- factor(sample(c("alto", "medio", "baixo"), 30, rep = TRUE))
fa
```

---

# 3.9 forcats

## Pacote para manejar os **levels** dos fatores

### **fct_relevel**: reordena os levels de forma simples
```{r}
fa.or <- fa %>% 
  fct_relevel(c("baixo", "medio", "alto"))
fa.or
```

---

class: clear, center, middle
background-image: url(https://www.rstudio.com/wp-content/uploads/2014/04/purrr.png)
background-size: 400px
background-position: 50% 50%

---

# 3.10 purrr

## Pacote que implementa **Programação Funcional**

### Calcular a média para várias colunas
```{r}
mean_var <- si %>% 
  select(species_number, altitude) %>% 
  map_dbl(mean)
mean_var
```

---

# 3.10 purrr

## Pacote que implementa **Programação Funcional**

### Calcular o desvio padrão para várias colunas
```{r}
mean_var <- si %>% 
  select(species_number, altitude) %>% 
  map_dbl(sd)
mean_var
```

---

class: clear, middle

## Maurício Vancine

<br>

Contatos:

|                                                                                           |                               |
| :---------------------------------------------------------------------------------------- | :---------------------------- |
| <a href="mailto:mauricio.vancine@gmail.com">.RUred[<i class="fa fa-envelope fa-fw"></i>]  | mauricio.vancine@gmail.com    |
| <a href="https://mauriciovancine.netlify.com/">.RUred[<i class="fa fa-link fa-fw"></i>]   | mauriciovancine.netlify.com   |
| <a href="http://twitter.com/mauriciovancine">.RUred[<i class="fa fa-twitter fa-fw"></i>]  | @mauriciovancine              |
| <a href="http://github.com/mauriciovancine">.RUred[<i class="fa fa-github fa-fw"></i>]    | @mauriciovancine              |

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)